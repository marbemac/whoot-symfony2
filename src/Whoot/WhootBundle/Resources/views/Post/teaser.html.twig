<div class="teaser post post-{{ post.id }}">
    <canvas title="{{ post.createdAt|timeLapse }}" class="timer" width="20" height="20" data-time="{{ post.createdAt|date('U') }}" data-type="{{ post.type }}">
        <div class="timer {{ post.type }}"></div>
    </canvas>

    <div class="profile-images">
        {% for userPost in post.users %}
            {% if userPost.status == 'Active' %}
                <a class="profile-image" href="{{ path('fos_user_user_show', {'username': userPost.user.username}) }}" title="{{ userPost.user.firstName }} {{ userPost.user.lastName }}">
                    <img src="{{ userPost.user.profileImage is defined ? '/slir/w30-h30-c1:1'~userPost.user.profileImage : gravatar(userPost.user.email, '30', 'r', 'mm') }}" alt="" />
                </a>
            {% endif %}
        {% endfor %}
    </div>

    <div class="content">
        <div class="post">

            {% set activeUsers = post.users|rebuildArray('status', 'Active') %}
            {% for userPost in activeUsers %}
                {% if loop.index <= 4 %}
                    {% set trail = '' %}
                    {% if loop.revindex0 == 1 and activeUsers|length > 2 %}
                        {% if activeUsers|length > 3 %}
                            {% set trail = ', and '~(activeUsers|length - 3)~' others' %}
                        {% else %}
                            {% set trail = ', and' %}
                        {% endif %}
                    {% elseif loop.revindex0 == 1 %}
                        {% set trail = ' and' %}
                    {% elseif not loop.last %}
                        {% set trail = ',' %}
                    {% endif %}
                {% elseif loop.revindex0 == 1 %}
                    {% set trail = ' and' %}
                {% elseif not loop.last %}
                    {% set trail = ',' %}
                {% endif %}

                {% if loop.index <= 3 %}
                    <a class="user" href="{{ path('fos_user_user_show', {'username': userPost.user.username}) }}">{{ userPost.user.firstName }} {{ userPost.user.lastName }}</a>
                    {{ trail }}
                {% endif %}
            {% endfor %}
            {{ activeUsers|length > 1 ? 'are' : 'is' }}
            {{ post.type|printPostType() }}.
        </div>

        <div class="note">{{ post.note ? '" ' : '' }}{{ post.note|stripSlashes|truncate(75) }}{{ post.note ? ' "' : '' }}</div>

        <div class="activity-list">
            {% for event in activity %}
                <div class="activity-post {{ event.class }}">
                    <div class="time">{{ event.time|timeLapse(1) }}</div>

                    <div class="message">
                        <a class="user" href="{{ path('fos_user_user_show', {'username': event.user.username}) }}">{{ event.user.firstName }} {{ event.user.lastName }}</a>
                        {{ event.message }}
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>

    {% if (post.createdAt|date('y-m-d') == "now-5 hours"|date('y-m-d')) %}
        {% render "WhootBundle:Post:jiveTag" with {'postId': post.id} %}
    {% endif %}

    <div class="clear"></div>
</div>